# Google Cloud Monitoring API

## Use Case : Determine the usage of  
To determine which users, groups, or service accounts are actively using Google Cloud Platform (GCP) services and identify users who have not used any service for the last x (say 30) days, we can use the Google Cloud Monitoring API along with some scripting in Python. 

Here's a general approach:

1. **Fetch Usage Data**: Use the Google Cloud Monitoring API to retrieve usage data for various GCP services. This data includes metrics like CPU usage, network traffic, and more.
2. **Analyze Usage Data**: Analyze the usage data to identify users, groups, or service accounts that have actively used GCP services within a specific time period (e.g., last 30 days).
3. **Identify Inactive Users**: Compare the list of all users, groups, or service accounts with the list of actively used entities to identify users who have not used any GCP services for the last x days.

Here's a Python script that demonstrates how you can achieve this using the google-cloud-monitoring library [getServiceUsageByUser.py](/GCP_IAM/Python_Code/getServiceUseageByUser.py) 

In this script:

* We use the google-cloud-monitoring library to query the Google Cloud Monitoring API to retrieve usage data for GCP services.
* We define a query to fetch CPU utilization metrics for instances within the last 30 days.
* We extract the instance IDs (or user IDs) from the query results as active users.
* We assume you have a function (get_all_users) to fetch all users, groups, and service accounts from GCP IAM. You can replace this with actual code to fetch this data.
* We compare the list of active users with all users to identify inactive users (users who have not used any GCP services in the last 30 days).

* You'll need to replace "your-project-id" with your actual GCP project ID, and ensure you have appropriate permissions to access the Monitoring API and IAM data. 
* Additionally, you'll need to adjust the usage data query and get_all_users function as per your specific requirements and the structure of your IAM data.


# Visualize GCP IAM users and their associated roles 
We can visualize GCP IAM users and their associated roles using various tools and libraries available for creating interactive diagrams. One popular option is to use Python along with libraries like NetworkX and matplotlib to generate the graph and visualize it. Additionally, you can use tools like Graphviz to create interactive diagrams.

Here's a general approach to achieve this:

1. **Fetch IAM Policies**: Use the Google Cloud IAM API to fetch IAM policies for your GCP project(s). This will provide you with information about users, groups, and their associated roles.
2. **Create a Graph Representation**: Use NetworkX, a Python library for creating and manipulating graphs, to create a graph representation of IAM users and roles.
3. **Visualize the Graph**  : Use matplotlib, a Python plotting library, to visualize the graph generated by NetworkX. You can customize the visualization to make it interactive using tools like Plotly or Bokeh.
4. **(Optional) Export to Graphviz**: If you prefer using Graphviz for visualization, you can export the graph from NetworkX to Graphviz format and then use Graphviz tools to create interactive diagrams.

Here's an example code snippet to get you started with visualizing IAM users and their roles using NetworkX and matplotlib: [visualizeIAM_Permissions.py](/GCP_IAM/Python_Code/visualizeIAM_Permissions.py)

In this example:

We define sample IAM data representing users and their associated roles (replace this with actual IAM data fetched from GCP).
We use NetworkX to create a directed graph where nodes represent users and roles, and edges represent associations between users and roles.
We visualize the graph using matplotlib, with different node colors for users and roles.
You can customize this code to fit your specific requirements and preferences for visualization. Additionally, you can explore exporting the graph to Graphviz format for further customization and interactivity.